<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd"
	default-autowire="byName">
	
	<!-- view层配置 velocity cfg -->
	<!-- 配置velocity引擎 -->
    <bean id="velocityCfg" class="org.springframework.web.servlet.view.velocity.VelocityConfigurer">
        <!-- 模板存放的路径 -->
        <property name="resourceLoaderPath" value="/WEB-INF/vm/" />
        <!-- Velocity配置文件 -->
		<property name="velocityProperties">
			<props>
				<!-- 指定模板引擎进行模板处理的编码 --> 
				<prop key="input.encoding">${default.charset}</prop>
				<!-- 指定输出流的编码 -->
				<prop key="output.encoding">${default.charset}</prop>
				<!--指定 contentType -->
				<prop key="contentType">text/html;charset=${default.charset}</prop>
				<!--指定 定宏定义位置 -->
				<prop key="velocimacro.library">common/macro.vm</prop>
				<!-- 指定foreach 计数器名称-->
				<prop key="directive.foreach.counter.name">velocityCount</prop>
				<!-- 指定foreach 计数器初始值 2.0版本已被移除,使用 $foreach.index代替 -->
				<!-- <prop key="directive.foreach.counter.initial.value">0</prop> -->
			</props>
		</property>
    </bean>
   <!-- 配置velocity的试图解析 -->
   <bean id="velocityViewResolver" class = "org.springframework.web.servlet.view.velocity.VelocityLayoutViewResolver">
   		 <property name="layoutUrl" value="layout/default.vm" />
         <property name="order" value="0" />
         <property name="contentType" value="text/html;charset=${default.charset}" />
		 <!-- velocity是否使用缓存-->
		 <property name="cache" value="false" />
		 <!-- velocity文件的后缀名-->
		 <property name="suffix" value=".vm" />
		 <!--是否使用spring对宏定义的支持-->
		 <property name="exposeSpringMacroHelpers" value="true" />
		 <!--是否开放request属性-->
		  <property name="exposeRequestAttributes" value="true" />
		  <!--request属性引用名称-->
          <property name="requestContextAttribute" value="requestContext"/>
          <!--日期函数名称-->
		 <property name="dateToolAttribute" value="dateTool" />
		 <!--数字函数名称-->
		 <property name="numberToolAttribute" value="numberTool" />
    </bean>

	<!--JSP视图配置-->
	<bean id="jspView" class="org.springframework.web.servlet.view.InternalResourceViewResolver">
		<property name="viewClass" value="org.springframework.web.servlet.view.JstlView" />
		<property name="contentType" value="text/html;charset=${default.charset}" />
		<property name="prefix" value="/WEB-INF/jsp/"/>
		<property name="suffix" value=".jsp"/>
		<property name="order" value="10" />
	</bean>

	<!-- 配置spring视图解析器 -->
	<bean class="org.springframework.web.servlet.view.ContentNegotiatingViewResolver">
		<property name="contentNegotiationManager">
			<bean class="org.springframework.web.accept.ContentNegotiationManagerFactoryBean">
				<!-- 设置为true以忽略对Accept Header的支持 -->
				<property name="ignoreAcceptHeader" value="true" />
				<!-- 用于开启 /blog/123?format=json 的支持 -->
				<property name="favorParameter" value="false" />
				<!-- 在没有扩展名时即: "/blog/1" 时的默认展现形式 -->
				<property name="defaultContentType" value="text/html" />
				<!-- 扩展名至mimeType的映射,即 /blog.json => application/json -->
				<property name="mediaTypes">
					<value>
						pdf=application/pdf
						xsl=application/vnd.ms-excel
						xml=application/xml
						html=text/html
						json=application/json
					</value>
				</property>
			</bean>
		</property>


		<property name="viewResolvers">
			<list>
				<ref bean="velocityViewResolver" />
				<ref bean="jspView"/>
			</list>
		</property>
		<property name="defaultViews">
			<list>
				<!-- for application/json -->
				<!-- <bean class="org.springframework.web.servlet.view.json.MappingJackson2JsonView" /> -->
				<bean class="com.alibaba.fastjson.support.spring.FastJsonJsonView" />
			</list>
		</property>
	</bean>
</beans>